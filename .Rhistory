tsh_df = my_data %>%
mutate(lean_clean_read_machine = substr(CleansedReadCode, 1, 5) ) %>%
filter(lean_clean_read_machine %in% readcodes_tsh) %>%
select(MedCodeId, Term, lean_clean_read_machine)
View(tsh_df)
#Included Read Codes:
readcodes_tsh = c("442A.", "442e.", "442K.", "442L.", "442M.", "442N.", "442O.", "442P.", "442Q.", "442R.", "442S.", "442T.", "442W.", "442X.")
tsh_df = my_data %>%
mutate(lean_clean_read_machine = substr(CleansedReadCode, 1, 5) ) %>%
filter(lean_clean_read_machine %in% readcodes_tsh) %>%
select(MedCodeId, Term, lean_clean_read_machine)
View(tsh_df)
View(tsh_df)
readcodes_ttg = c("44Ce.", "43ad.", "43ae.")
readcodes_ttgantibody = "43aC."
ttg_df = my_data %>%
mutate(lean_clean_read_machine = substr(CleansedReadCode, 1, 5) ) %>%
filter(lean_clean_read_machine %in% readcodes_ttg) %>%
select(MedCodeId, Term, lean_clean_read_machine)
View(ttg_df)
write.table(tsh_df, "exeter_medcodelist_tsh.txt", sep = "\t")
write.table(ttg_df, "exeter_medcodelist_ttg.txt", sep = "\t")
tsh_df = my_data %>%
mutate(read_code = substr(CleansedReadCode, 1, 5) ) %>%
filter(read_code %in% readcodes_tsh) %>%
select(MedCodeId, Term, lean_clean_read_machine)
View(tsh_df)
#Included Read Codes:
readcodes_tsh = c("442A.", "442e.", "442K.", "442L.", "442M.", "442N.", "442O.", "442P.", "442Q.", "442R.", "442S.", "442T.", "442W.", "442X.")
readcodes_tshantibody = "43Gu."
filepath = '~/Downloads/CPRDAurumMedical.txt'
my_data <- import(filepath)
View(my_data)
tsh_df = my_data %>%
mutate(read_code = substr(CleansedReadCode, 1, 5) ) %>%
filter(read_code %in% readcodes_tsh) %>%
select(MedCodeId, Term, lean_clean_read_machine)
tsh_df = my_data %>%
mutate(read_code = substr(CleansedReadCode, 1, 5) ) %>%
filter(read_code %in% readcodes_tsh) %>%
select(MedCodeId, Term, read_code)
ttg_df = my_data %>%
mutate(read_code = substr(CleansedReadCode, 1, 5) ) %>%
filter(read_code %in% readcodes_ttg) %>%
select(MedCodeId, Term, read_code) %>%
View(ttg_df)
ttg_df = my_data %>%
mutate(read_code = substr(CleansedReadCode, 1, 5) ) %>%
filter(read_code %in% readcodes_ttg) %>%
select(MedCodeId, Term, read_code)
write.table(tsh_df, "exeter_medcodelist_tsh.txt", sep = "\t")
write.table(ttg_df, "exeter_medcodelist_ttg.txt", sep = "\t")
write.table(tsh_df, "exeter_medcodelist_tsh.txt", sep = "\t", row.names = TRUE)
write.table(tsh_df, "exeter_medcodelist_tsh.txt", sep = "\t", row.names = TRUE, col.names = TRUE)
write.table(tsh_df, "exeter_medcodelist_tsh.txt", quote=FALSE, sep = "\t", row.names=FALSE, col.names=TRUE)
write.table(ttg_df, "exeter_medcodelist_ttg.txt", quote=FALSE, sep = "\t", row.names=FALSE, col.names=TRUE)
knitr::opts_chunk$set(echo = TRUE)
library(devtools) # Essential for Aurum integration
library(devtools) # Essential for Aurum integration
library(tidyverse)  # streamlining R coding since 2016
library(r2r) # Used in Hashmaps later
library(RMySQL)
library(aurum)
cprd = CPRDData$new(cprdEnv = "test-remote", cprdConf = '~/RStudio/aurum.yaml')
cprd = CPRDData$new(cprdEnv = "test-remote", cprdConf = '~/RStudio/aurum.yaml')
analysis = cprd$analysis("all")
# Obtaining new Weight Table to pull into my data
weight_data = weight_data %>%
analysis$cached("patid_clean_weight_medcodes")
# Obtaining my table to add to
analysis = cprd$analysis("ethan")
my_cohort = my_cohort %>%
analysis$cached("atdiagnosis_v2_instime")
raw_weight = my_cohort %>%
select(patid, dm_diag_date_all) %>%
left_join(weight_data, by="patid") %>%
mutate(date_diff = datediff(date, dm_diag_date_all)/7) %>%
filter(date_diff >= -12 & date_diff <=6) %>%
group_by(patid) %>%
mutate(min_date_diff=min(abs(date_diff), na.rm=TRUE)) %>%
dbplyr::window_order(date_diff) %>%
filter(row_number()==1) %>%
ungroup() %>%
filter(abs(date_diff)==min_date_diff) %>%
analysis$cached("atdiagnosis_raw_weight")
my_cohort = my_cohort %>%
left_join(
raw_weight %>%
select(patid, bmi=testvalue, bmi_date=date),
by="patid"
) %>%
analysis$cached("atdiagnosis_v3_weight")
my_cohort = my_cohort %>%
left_join(
raw_weight %>%
select(patid, weight=testvalue, weight_date=date),
by="patid"
) %>%
analysis$cached("atdiagnosis_v3_weight")
my_cohort = my_cohort %>%
left_join(
raw_weight %>%
select(patid, weight=testvalue, weight_date=date),
by="patid"
) %>%
analysis$cached("atdiagnosis_v3_weight")
my_cohort = NA
my_cohort = my_cohort %>%
left_join(
raw_weight %>%
select(patid, weight=testvalue, weight_date=date),
by="patid"
) %>%
analysis$cached("atdiagnosis_v3_weight")
my_cohort = my_cohort %>%
analysis$cached("atdiagnosis_v2_instime")
my_cohort = my_cohort %>%
left_join(
raw_weight %>%
select(patid, weight=testvalue, weight_date=date),
by="patid"
) %>%
analysis$cached("atdiagnosis_v3_weight")
analysis = cprd$analysis("all")
analysis = cprd$analysis("all")
# Obtaining new Weight Table to pull into my data
height_data = height_data %>%
analysis$cached("patid_clean_height_medcodes")
# No need to assign my_cohort as it was assigned to _v3_weight in last section
analysis = cprd$analysis("ethan")
raw_height = my_cohort %>%
select(patid, dm_diag_date_all) %>%
left_join(height_data, by="patid") %>%
mutate(date_diff = datediff(date, dm_diag_date_all)/7) %>%
filter(date_diff >= -12 & date_diff <=6) %>%
group_by(patid) %>%
mutate(min_date_diff=min(abs(date_diff), na.rm=TRUE)) %>%
dbplyr::window_order(date_diff) %>%
filter(row_number()==1) %>%
ungroup() %>%
filter(abs(date_diff)==min_date_diff) %>%
analysis$cached("atdiagnosis_raw_height")
my_cohort = my_cohort %>%
left_join(
raw_height %>%
select(patid, height=testvalue, height_date=date),
by="patid"
) %>%
analysis$cached("atdiagnosis_v4_height")
my_cohort = my_cohort %>%
analysis$cached("atdiagnosis_v4_height")
### Model 1 logOddsRatio = 37.94 + (-5.09 * log(age at diagnosis)) + (-6.34 * log(BMI))
### Model Probability = exp(logOR) / (1 + exp(logOR))
# model_data = model_data %>%
#   mutate(Model5Prob = ifelse(!is.na(Model5LogOR), exp(Model5LogOR) / (1 + exp(Model5LogOR)), NA))
my_cohort = my_cohort %>%
analysis$cached("atdiagnosis_v4_height")
my_cohort = my_cohort %>%
mutate(model1prob = ifelse(!is.na(dm_diag_age_all) & !is.na(bmi),
exp(37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi))) / (1 + exp(37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi)))),
NULL)) %>%
analysis$cached("atdiagnosis_v5_model1")
my_cohort = my_cohort %>%
analysis$cached("atdiagnosis_v4_height")
my_cohort = my_cohort %>%
mutate(model1prob = ifelse(!is.na(dm_diag_age_all) & !is.na(bmi),
exp(37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi))) / (1 + exp(37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi)))),
NULL)) %>%
analysis$cached("atdiagnosis_v5_model1")
my_cohort = my_cohort %>%
analysis$cached("atdiagnosis_v4_height")
my_cohort = my_cohort %>%
mutate(model1_logor = ifelse(!is.na(dm_diag_age_all) & !is.na(bmi),
37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi)),
NULL)) %>%
analysis$cached("atdiagnosis_test_model1log")
my_cohort = my_cohort %>%
select(dm_diag_age_all & bmi) %>%
mutate(model1_logor = ifelse(!is.na(dm_diag_age_all) & !is.na(bmi),
37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi)),
NULL)) %>%
analysis$cached("atdiagnosis_test_model1log")
my_cohort = my_cohort %>%
select(dm_diag_age_all, bmi) %>%
mutate(model1_logor = ifelse(!is.na(dm_diag_age_all) & !is.na(bmi),
37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi)),
NULL)) %>%
analysis$cached("atdiagnosis_test_model1log")
analysis = cprd$analysis("all")
# Obtaining new Weight Table to pull into my data
hba1c_data = hba1c_data %>%
analysis$cached("patid_clean_hba1c_medcodes")
# No need to assign my_cohort as it was assigned as newest version in last section
analysis = cprd$analysis("ethan")
raw_hba1c = my_cohort %>% # takes about 10 mins to run on Slade
select(patid, dm_diag_date_all) %>%
left_join(height_data, by="patid") %>%
mutate(date_diff = datediff(date, dm_diag_date_all)/7) %>%
filter(date_diff >= -12 & date_diff <=6) %>%
group_by(patid) %>%
mutate(min_date_diff=min(abs(date_diff), na.rm=TRUE)) %>%
dbplyr::window_order(date_diff) %>%
filter(row_number()==1) %>%
ungroup() %>%
filter(abs(date_diff)==min_date_diff) %>%
analysis$cached("atdiagnosis_raw_hba1c")
my_cohort = my_cohort %>%
left_join(
raw_hba1c %>%
select(patid, hba1c=testvalue, hba1c_date=date),
by="patid"
) %>%
analysis$cached("atdiagnosis_v5_hba1c")
analysis = cprd$analysis("all")
# Obtaining new Weight Table to pull into my data
hba1c_data = hba1c_data %>%
analysis$cached("patid_clean_hba1c_medcodes")
# No need to assign my_cohort as it was assigned as newest version in last section
analysis = cprd$analysis("ethan")
raw_hba1c = my_cohort %>% # takes about 10 mins to run on Slade
select(patid, dm_diag_date_all) %>%
left_join(hba1c_data, by="patid") %>%
mutate(date_diff = datediff(date, dm_diag_date_all)/7) %>%
filter(date_diff >= -12 & date_diff <=6) %>%
group_by(patid) %>%
mutate(min_date_diff=min(abs(date_diff), na.rm=TRUE)) %>%
dbplyr::window_order(date_diff) %>%
filter(row_number()==1) %>%
ungroup() %>%
filter(abs(date_diff)==min_date_diff) %>%
analysis$cached("atdiagnosis_raw_hba1c")
my_cohort = my_cohort %>%
analysis$cached("atdiagnosis_v2_instime")
analysis = cprd$analysis("all")
# Obtaining new Weight Table to pull into my data
hba1c_data = hba1c_data %>%
analysis$cached("patid_clean_hba1c_medcodes")
# No need to assign my_cohort as it was assigned as newest version in last section
analysis = cprd$analysis("ethan")
raw_hba1c = my_cohort %>% # takes about 10 mins to run on Slade
select(patid, dm_diag_date_all) %>%
left_join(hba1c_data, by="patid") %>%
mutate(date_diff = datediff(date, dm_diag_date_all)/7) %>%
filter(date_diff >= -12 & date_diff <=6) %>%
group_by(patid) %>%
mutate(min_date_diff=min(abs(date_diff), na.rm=TRUE)) %>%
dbplyr::window_order(date_diff) %>%
filter(row_number()==1) %>%
ungroup() %>%
filter(abs(date_diff)==min_date_diff) %>%
analysis$cached("atdiagnosis_raw_hba1c")
my_cohort = my_cohort %>%
left_join(
raw_hba1c %>%
select(patid, hba1c=testvalue, hba1c_date=date),
by="patid"
) %>%
analysis$cached("atdiagnosis_v5_hba1c")
my_cohort = my_cohort %>%
analysis$cached("atdiagnosis_v4_height")
analysis = cprd$analysis("all")
# Obtaining new Weight Table to pull into my data
hba1c_data = hba1c_data %>%
analysis$cached("patid_clean_hba1c_medcodes")
# So... Always re-assign to the latest version to avoid versioning issues :(
analysis = cprd$analysis("ethan")
my_cohort = my_cohort %>%
analysis$cached("atdiagnosis_v4_height")
raw_hba1c = my_cohort %>% # takes about 10 mins to run on Slade
select(patid, dm_diag_date_all) %>%
left_join(hba1c_data, by="patid") %>%
mutate(date_diff = datediff(date, dm_diag_date_all)/7) %>%
filter(date_diff >= -12 & date_diff <=6) %>%
group_by(patid) %>%
mutate(min_date_diff=min(abs(date_diff), na.rm=TRUE)) %>%
dbplyr::window_order(date_diff) %>%
filter(row_number()==1) %>%
ungroup() %>%
filter(abs(date_diff)==min_date_diff) %>%
analysis$cached("atdiagnosis_raw_hba1c")
my_cohort = my_cohort %>%
left_join(
raw_hba1c %>%
select(patid, hba1c=testvalue, hba1c_date=date),
by="patid"
) %>%
analysis$cached("atdiagnosis_v5_hba1c")
analysis = cprd$analysis("all")
# Obtaining new Weight Table to pull into my data
hba1c_data = hba1c_data %>%
analysis$cached("patid_clean_hba1c_medcodes")
# So... Always re-assign to the latest version to avoid versioning issues :(
analysis = cprd$analysis("ethan")
my_cohort = my_cohort %>%
analysis$cached("atdiagnosis_v4_height")
raw_hba1c = my_cohort %>% # takes about 10 mins to run on Slade
select(patid, dm_diag_date_all) %>%
left_join(hba1c_data, by="patid") %>%
mutate(date_diff = datediff(date, dm_diag_date_all)/7) %>%
filter(date_diff >= -12 & date_diff <=6) %>%
group_by(patid) %>%
mutate(min_date_diff=min(abs(date_diff), na.rm=TRUE)) %>%
dbplyr::window_order(date_diff) %>%
filter(row_number()==1) %>%
ungroup() %>%
filter(abs(date_diff)==min_date_diff) %>%
analysis$cached("atdiagnosis_raw_hba1c")
my_cohort = my_cohort %>%
left_join(
raw_hba1c %>%
select(patid, hba1c=testvalue, hba1c_date=date),
by="patid"
) %>%
analysis$cached("atdiagnosis_v5_hba1c")
### Model 1 logOddsRatio = 37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi))
### Model Probability = exp(logOR) / (1 + exp(logOR))
# model_data = model_data %>%
#   mutate(Model5Prob = ifelse(!is.na(Model5LogOR), exp(Model5LogOR) / (1 + exp(Model5LogOR)), NA))
my_cohort = my_cohort %>%
analysis$cached("atdiagnosis_v5_hba1c")
my_cohort = my_cohort %>%
mutate(dm_diag_age_all = ifelse(dm_diag_age_all < 0, NULL, dm_diag_age_all)) %>%
mutate(model1_logor = ifelse(!is.na(dm_diag_age_all) & !is.na(bmi),
exp(37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi))) / (1 + exp(37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi)))),
NULL)) %>%
analysis$cached("atdiagnosis_test_model1log")
### Model 1 logOddsRatio = 37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi))
### Model Probability = exp(logOR) / (1 + exp(logOR))
# model_data = model_data %>%
#   mutate(Model5Prob = ifelse(!is.na(Model5LogOR), exp(Model5LogOR) / (1 + exp(Model5LogOR)), NA))
my_cohort = my_cohort %>%
analysis$cached("atdiagnosis_v5_hba1c")
my_cohort = my_cohort %>%
mutate(dm_diag_age_all = ifelse(dm_diag_age_all < 0, NULL, dm_diag_age_all)) %>%
mutate(model1_logor = ifelse(!is.na(dm_diag_age_all) & !is.na(bmi),
exp(37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi))) / (1 + exp(37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi)))),
NULL)) %>%
analysis$cached("atdiagnosis_test_model1log")
### Model 1 logOddsRatio = 37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi))
### Model Probability = exp(logOR) / (1 + exp(logOR))
# model_data = model_data %>%
#   mutate(Model5Prob = ifelse(!is.na(Model5LogOR), exp(Model5LogOR) / (1 + exp(Model5LogOR)), NA))
my_cohort = my_cohort %>%
analysis$cached("atdiagnosis_v5_hba1c")
my_cohort = my_cohort %>%
mutate(dm_diag_age_all = ifelse(dm_diag_age_all < 0, NULL, dm_diag_age_all), na.rm=TRUE) %>%
mutate(model1_logor = ifelse(!is.na(dm_diag_age_all) & !is.na(bmi),
exp(37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi))) / (1 + exp(37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi)))),
NULL)) %>%
analysis$cached("atdiagnosis_test_model1log")
my_cohort = my_cohort %>%
mutate(dm_diag_age_all = ifelse(dm_diag_age_all < 0, 0, dm_diag_age_all)) %>%
mutate(model1_logor = ifelse(!is.na(dm_diag_age_all) & !is.na(bmi) & dm_diag_age_all != 0,
exp(37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi))) / (1 + exp(37.94 + (-5.09 * log(dm_diag_age_all)) + (-6.34 * log(bmi)))),
NULL)) %>%
analysis$cached("atdiagnosis_test_model1log")
library(devtools) # Essential for Aurum integration
library(tidyverse)  # streamlining R coding since 2016
library(r2r) # Used in Hashmaps later
library(RMySQL)
install_github('drkgyoung/Exeter_Diabetes_aurum_package') # Package created by Exeter University to work with CPRD data
library(aurum)
cprd = CPRDData$new(cprdEnv = "test-remote", cprdConf = '~/RStudio/aurum.yaml')
analysis = cprd$analysis("all_patid")
cprd = CPRDData$new(cprdEnv = "test-remote", cprdConf = '~/RStudio/aurum.yaml')
analysis = cprd$analysis("all_patid")
ethan_raw_test <- cprd$tables$observation %>%
inner_join(codes$gad_abs, by="medcodeid") %>%
analysis$cached("ethan_raw_test", indexes=c("patid", "obsdate", "testvalue", "numunitid"))
codesets = cprd$codesets()
codes = codesets$getAllCodeSetVersion()
codes = codesets$getAllCodeSetVersion(v = "31/10/2021")
analysis = cprd$analysis("all_patid")
ethan_raw_test <- cprd$tables$observation %>%
inner_join(codes$gad_abs, by="medcodeid") %>%
analysis$cached("ethan_raw_test", indexes=c("patid", "obsdate", "testvalue", "numunitid"))
library(rio)
readcodes_ICA = "43a3."
readcodes_IA2 = "43ax."
filepath = '~/Downloads/CPRDAurumMedical.txt'
my_data <- import(filepath)
knitr::opts_chunk$set(echo = TRUE)
library(rio)
filepath = '~/Downloads/CPRDAurumMedical.txt'
my_data <- import(filepath)
readcodes_ICA = "43a3."
ICA_df = my_data %>%
filter(read_code == "43a3.") %>%
mutate(read_code = substr(CleansedReadCode, 1, 5) ) %>%
select(MedCodeId, Term, read_code)
ICA_df = my_data %>%
mutate(read_code = substr(CleansedReadCode, 1, 5) ) %>%
filter(read_code == "43a3.") %>%
select(MedCodeId, Term, read_code)
ICA_df = my_data %>%
mutate(read_code = substr(CleansedReadCode, 1, 5) ) %>%
filter(read_code == readcodes_ICA) %>%
select(MedCodeId, Term, read_code)
write.table(ICA_df, "exeter_medcodelist_ica.txt", quote=FALSE, sep = "\t", row.names=FALSE, col.names=TRUE)
readcodes_IA2 = "43ax."
IA2_df = my_data %>%
mutate(read_code = substr(CleansedReadCode, 1, 5) ) %>%
filter(read_code == readcodes_IA2) %>%
select(MedCodeId, Term, read_code)
write.table(IA2_df, "exeter_medcodelist_ia2.txt", quote=FALSE, sep = "\t", row.names=FALSE, col.names=TRUE)
cprd = CPRDData$new(cprdEnv = "test-remote", cprdConf = '~/RStudio/aurum.yaml')
cprd = CPRDData$new(cprdEnv = "test-remote", cprdConf = '~/RStudio/aurum.yaml')
codesets = cprd$codesets()
codes = codesets$getAllCodeSetVersion(v = "31/10/2021")
analysis = cprd$analysis("all_patid")
ethan_raw_test <- cprd$tables$observation %>%
inner_join(codes$gad_abs, by="medcodeid") %>%
analysis$cached("raw_gad", indexes=c("patid", "obsdate", "testvalue", "numunitid"))
ethan_raw_IA2 <- cprd$tables$observation %>%
inner_join(codes$ia2, by="medcodeid") %>%
analysis$cached("raw_ia2", indexes=c("patid", "obsdate", "testvalue", "numunitid"))
ethan_raw_ICA <- cprd$tables$observation %>%
inner_join(codes$ica, by="medcodeid") %>%
analysis$cached("raw_ica", indexes=c("patid", "obsdate", "testvalue", "numunitid"))
gad_df = gad_df %>%
analysis$cached("gad") %>%
rbind.data.frame()
analysis = cprd$analysis("all_patid_raw")
gad_df = gad_df %>%
analysis$cached("gad") %>%
rbind.data.frame()
gad_df = gad_df %>%
analysis$cached("gad") %>%
cbind.data.frame()
hist(gad_df$testvalue)
# Produce Hist of IA2
gad_df = gad_df %>%
analysis$cached("ia2") %>%
cbind.data.frame()
hist(gad_df$testvalue)
# Produce Hist of GAD
gad = gad_df %>%
analysis$cached("gad") %>%
cbind.data.frame()
analysis = cprd$analysis("all_patid_raw")
# Produce Hist of GAD
gad = gad_df %>%
analysis$cached("gad") %>%
cbind.data.frame()
hist(gad_df$testvalue)
# Produce Hist of IA2
ia2 = gad_df %>%
analysis$cached("ia2") %>%
cbind.data.frame()
hist(gad_df$testvalue)
# Produce Hist of ICA
ica = gad_df %>%
analysis$cached("ica") %>%
cbind.data.frame()
hist(gad_df$testvalue)
analysis = cprd$analysis("all_patid_raw")
# Produce Hist of GAD
gad = gad_df %>%
analysis$cached("gad") %>%
cbind.data.frame()
hist(gad_df$testvalue)
# Produce Hist of IA2
ia2 = ia2 %>%
analysis$cached("ia2") %>%
cbind.data.frame()
hist(gad_df$testvalue)
# Produce Hist of ICA
ica = ica %>%
analysis$cached("ica") %>%
cbind.data.frame()
hist(gad_df$testvalue)
analysis = cprd$analysis("all_patid_raw")
# Produce Hist of GAD
gad = gad_df %>%
analysis$cached("gad") %>%
cbind.data.frame()
hist(gad_df$testvalue)
# Produce Hist of IA2
ia2 = ia2 %>%
analysis$cached("ia2") %>%
cbind.data.frame()
hist(ia2$testvalue)
# Produce Hist of ICA
ica = ica %>%
analysis$cached("ica") %>%
cbind.data.frame()
hist(ica$testvalue)
gad_df %>%
ggplot2::ggplot() +
geom_violin(aes(x = key, y = value)) +
xlab('') +
ylab('Probability')
gad_df %>%
ggplot2::ggplot() +
geom_violin(aes( y = testvalue)) +
xlab('') +
ylab('Probability')
cprd = CPRDData$new(cprdEnv = "test-remote", cprdConf = '~/RStudio/aurum.yaml')
library(devtools) # Essential for Aurum integration
library(tidyverse)  # streamlining R coding since 2016
library(r2r) # Used in Hashmaps later
library(RMySQL)
install_github('drkgyoung/Exeter_Diabetes_aurum_package') # Package created by Exeter University to work with CPRD data
library(aurum)
cprd = CPRDData$new(cprdEnv = "test-remote", cprdConf = '~/RStudio/aurum.yaml')
t1t2 = t1t2 %>%
analysis$cached("t1t2_cohort")
analysis = cprd$analysis("all")
t1t2 = t1t2 %>%
analysis$cached("t1t2_cohort")
codesets = cprd$codesets()
codes = codesets$getAllCodeSetVersion(v = "31/10/2021")
